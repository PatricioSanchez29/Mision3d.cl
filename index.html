<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mision3D - Tienda</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="header-new-style.css"/>
  <script>window.GA_MEASUREMENT_ID = 'G-XXXXXXXXXX';</script>
  <script src="consent.js"></script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Misi√≥n 3D",
    "url": "https://tudominio.cl/",
    "logo": "https://tudominio.cl/img/Logo_Mision3d.jpg",
    "sameAs": []
  }
  </script>
</head>
<body>
  <header class="header">
    <!-- Bot√≥n Hamburguesa (solo m√≥vil) -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Abrir men√∫">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>

    <h1 class="logo" style="margin:0;display:flex;align-items:center">
      <a href="index.html" style="display:inline-flex;align-items:center;text-decoration:none">
        <img src="img/Logo_Mision3d.jpg" alt="Misi√≥n 3D" class="logo-img" onerror="this.onerror=null;this.replaceWith(Object.assign(document.createElement('span'),{className:'logo-text',textContent:'Misi√≥n 3D'}));" />
      </a>
    </h1>
    <nav class="nav">
      <a href="index.html" class="active">Inicio</a>
      <a href="catalogo.html" id="navCatalog">Cat√°logo</a>
      <a href="#contacto">Contacto</a>
    </nav>
    <div class="search-header">
      <div class="advanced-search-bar">
        <select id="headerCategorySelect" class="category-select">
          <option value="all">Todas las categor√≠as</option>
        </select>
        <input type="text" id="searchInput" placeholder="¬øQu√© est√°s buscando?" class="search-input" autocomplete="off">
        <button type="button" id="headerSearchBtn" class="search-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
      <div id="searchSuggestions" class="search-suggestions"></div>
      <div id="headerTrendChips" class="trend-chips" aria-label="B√∫squedas populares"></div>
    </div>
    <div class="right-actions" style="display:flex;align-items:center;gap:10px">
      <div id="userArea" class="user-area">
        <a href="login.html" id="loginLink" class="btn small outline">Ingresar</a>
      </div>
      <button class="cart-btn" id="openCart" aria-label="Abrir carrito">üõí <span id="cartCount">0</span></button>
    </div>
  </header>
  <div class="announcement-bar"><div class="ann-track"><span>Santiago despacho 2 a 3 d√≠as h√°biles ‚Ä¢ Regiones env√≠o 4 a 5 d√≠as h√°biles ‚Ä¢ Pedidos personalizados: cotizaci√≥n gratuita ‚Ä¢ Soporte directo v√≠a WhatsApp ‚Ä¢ Santiago despacho 2 a 3 d√≠as h√°biles ‚Ä¢ Regiones env√≠o 4 a 5 d√≠as h√°biles ‚Ä¢ Pedidos personalizados: cotizaci√≥n gratuita ‚Ä¢ Soporte directo v√≠a WhatsApp ‚Ä¢ Santiago despacho 2 a 3 d√≠as h√°biles ‚Ä¢ Regiones env√≠o 4 a 5 d√≠as h√°biles ‚Ä¢ Pedidos personalizados: cotizaci√≥n gratuita ‚Ä¢ Soporte directo v√≠a WhatsApp ‚Ä¢ Santiago despacho 2 a 3 d√≠as h√°biles ‚Ä¢ Regiones env√≠o 4 a 5 d√≠as h√°biles ‚Ä¢ Pedidos personalizados: cotizaci√≥n gratuita ‚Ä¢ Soporte directo v√≠a WhatsApp ‚Ä¢ </span></div></div>

  <!-- Mini resumen carrito -->
  <section id="miniCart" style="max-width:1200px;margin:10px auto 0;padding:0 20px;display:none">
    <div style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px 16px;display:flex;flex-direction:column;gap:10px;box-shadow:0 2px 4px rgba(0,0,0,.05)">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <strong style="font-size:.9rem;letter-spacing:.5px">Tu Carrito</strong>
        <button id="miniCartToggle" style="background:#4f46e5;color:#fff;border:none;padding:4px 10px;border-radius:16px;font-size:.65rem;cursor:pointer">Ver todo</button>
      </div>
      <div id="miniCartItems" style="display:flex;flex-direction:column;gap:8px;max-height:170px;overflow:auto"></div>
      <div style="display:flex;justify-content:space-between;align-items:center;font-size:.75rem;margin-top:4px">
        <span id="miniCartCount" style="color:#555"></span>
        <div style="display:flex;align-items:center;gap:10px"><strong id="miniCartTotal" style="font-size:.85rem">$0</strong><button id="miniCartCheckout" style="background:#e6462f;color:#fff;border:none;padding:6px 12px;border-radius:20px;font-size:.65rem;cursor:pointer">Checkout</button></div>
      </div>
    </div>
  </section>

  <!-- Hero -->
  <section class="hero" id="hero">
    <div class="hero-content">
      <h2 class="hero-title">Impresi√≥n 3D Personalizada</h2>
      <p class="hero-subtitle">Traemos tus ideas al mundo real y enviamos a todo Chile.</p>
      <div class="hero-badges">
        <span class="hero-badge">‚ú® Calidad Premium</span>
        <span class="hero-badge">üöÄ Env√≠o R√°pido</span>
        <span class="hero-badge">üí° 100% Personalizable</span>
      </div>
    </div>
    <div class="hero-decoration"></div>
  </section>

  <!-- Productos (versi√≥n simplificada inicio) -->
  <section id="productos" class="productos">
    <h3 class="section-title" style="text-align:center">Cat√°logo Destacado</h3>
    <p class="section-subtitle" style="text-align:center">Descubre nuestros productos m√°s populares de impresi√≥n 3D</p>
    <div style="display:flex;justify-content:center;width:100%">
      <div class="grid" id="homeProductsGrid" style="justify-content:center;grid-template-columns:repeat(2, minmax(220px, 1fr));max-width:500px;width:100%"></div>
    </div>
    <p style="margin-top:30px;text-align:center">
      <a href="catalogo.html" class="btn-ver-mas">
        Ver cat√°logo completo 
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </a>
    </p>
  </section>

  <!-- Beneficios -->
  <section class="beneficios" id="beneficios">
    <div class="beneficios-header">
      <h3 class="section-title">¬øPor qu√© elegirnos?</h3>
      <p class="section-subtitle">Calidad, rapidez y atenci√≥n personalizada en cada pedido</p>
    </div>
    <div class="beneficios-grid">
      <div class="item">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 8H4V6C4 4.9 4.9 4 6 4H18C19.1 4 20 4.9 20 6V8Z" fill="#6366f1" opacity="0.3"/>
          <path d="M20 8V18C20 19.1 19.1 20 18 20H6C4.9 20 4 19.1 4 18V8M1 8H23M12 12V16M9 20L7 23M15 20L17 23" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h4>Env√≠o a todo Chile</h4>
        <p>Despachos r√°pidos y seguros a todo el pa√≠s</p>
      </div>
      <div class="item">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" fill="#10b981" opacity="0.3"/>
          <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8" cy="10" r="1" fill="#10b981"/>
          <circle cx="12" cy="10" r="1" fill="#10b981"/>
          <circle cx="16" cy="10" r="1" fill="#10b981"/>
        </svg>
        <h4>Contacto directo</h4>
        <p>Atenci√≥n personalizada v√≠a WhatsApp</p>
      </div>
      <div class="item">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="4" y="3" width="16" height="18" rx="2" fill="#f59e0b" opacity="0.3"/>
          <path d="M12 6V10M12 14H12.01M8 18H16C17.1046 18 18 17.1046 18 16V8C18 6.89543 17.1046 6 16 6H8C6.89543 6 6 6.89543 6 8V16C6 17.1046 6.89543 18 8 18Z" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/>
          <circle cx="12" cy="14" r="0.5" fill="#f59e0b"/>
        </svg>
        <h4>Soporte en l√≠nea</h4>
        <p>Resolvemos tus dudas en tiempo real</p>
      </div>
      <div class="item">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" fill="#8b5cf6" opacity="0.3"/>
          <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M14 2V8H20" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 18V12M9 15L12 12L15 15" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h4>Calidad Premium</h4>
        <p>Impresi√≥n 3D profesional garantizada</p>
      </div>
    </div>
  </section>
  <!-- Nosotros -->
  <section id="nosotros" class="nosotros"><h3>Sobre Mision3D</h3><p>Emprendimiento chileno de impresi√≥n 3D personalizada. Creamos desde piezas funcionales hasta figuras coleccionables y enviamos a todo Chile.</p></section>

  <!-- Contacto -->
  <section id="contacto" class="contacto"><h3>Cont√°ctanos</h3><p>Haz tus pedidos por WhatsApp o Instagram.</p><a href="https://wa.me/56950503585" class="btn whatsapp">WhatsApp</a><a href="https://instagram.com/mision3d.cl" class="btn instagram">Instagram</a></section>

  <!-- Preguntas Frecuentes -->
  <section id="faq" class="faq-section">
    <div class="faq-bg"><img src="img/impresion.png" alt="" aria-hidden="true" /></div>
    <div class="faq-inner">
      <h2>Preguntas Frecuentes</h2>
      <div class="faq-category">Importante</div>
      <ul class="faq-list" id="faqList">
        <li class="faq-item">
          <div class="faq-q"><span class="icon">üïí</span><span>¬øCu√°nto demora mi pedido?</span><span class="faq-toggle">‚ñæ</span></div>
          <div class="faq-a"><p>Depende de la complejidad y cantidad. Piezas simples: 2 a 3 d√≠as h√°biles. Proyectos personalizados o grandes: 5 a 10 d√≠as. Siempre te mantenemos informado del avance.</p></div>
        </li>
        <li class="faq-item">
          <div class="faq-q"><span class="icon">üöö</span><span>¬øHacen env√≠os? ¬øCu√°nto cuesta?</span><span class="faq-toggle">‚ñæ</span></div>
          <div class="faq-a"><p>Realizamos env√≠os a todo Chile v√≠a couriers confiables. En Santiago ofrecemos entrega a domicilio fija y tambi√©n retiro en taller sin costo. El valor regional depende del peso y destino.</p></div>
        </li>
        <li class="faq-item">
          <div class="faq-q"><span class="icon">üé®</span><span>¬øPuedo pedir algo personalizado?</span><span class="faq-toggle">‚ñæ</span></div>
          <div class="faq-a"><p>S√≠. Puedes enviarnos tu idea, referencia o modelo. Si necesitas dise√±o 3D desde cero, evaluamos el trabajo adicional y te enviamos una cotizaci√≥n antes de imprimir.</p></div>
        </li>
        <li class="faq-item">
            <div class="faq-q"><span class="icon">üßº</span><span>¬øC√≥mo cuido mi impresi√≥n 3D?</span><span class="faq-toggle">‚ñæ</span></div>
            <div class="faq-a"><p>Mant√©n lejos de calor extremo (>60¬∞C si es PLA). L√≠mpiala con un pa√±o seco o levemente h√∫medo sin solventes. Evita golpes o presi√≥n en piezas delgadas.</p></div>
        </li>
        <li class="faq-item">
          <div class="faq-q"><span class="icon">‚Ü©Ô∏è</span><span>¬øPuedo devolver un producto?</span><span class="faq-toggle">‚ñæ</span></div>
          <div class="faq-a"><p>Productos personalizados no tienen devoluci√≥n salvo falla de fabricaci√≥n. Si hubo un error nuestro, re-imprimimos o devolvemos el dinero.</p></div>
        </li>
        <li class="faq-item">
          <div class="faq-q"><span class="icon">üêæ</span><span>¬øHacen modelos de mascotas?</span><span class="faq-toggle">‚ñæ</span></div>
          <div class="faq-a"><p>¬°S√≠! Con fotos de buena calidad podemos crear una figura estilizada. Tambi√©n ofrecemos pintura b√°sica con costo adicional.</p></div>
        </li>
      </ul>
    </div>
  </section>


  <!-- Footer -->
  <footer class="footer">
    <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 30px; align-items: start;">
      <div style="display: flex; align-items: center; gap: 10px;">
        <img src="img/Logo_Mision3d.jpg" alt="Misi√≥n 3D" class="footer-logo remove-white" style="width: 80px; flex-shrink: 0;" />
        <p style="color: #888; font-size: 0.9rem; line-height: 1.6; margin: 0;">
          Impresi√≥n 3D personalizada<br>
          Transforma tus ideas en realidad
        </p>
      </div>        <div>
          <h4 style="margin: 0 0 15px 0; color: #0052cc; font-size: 1rem;">Contacto</h4>
          <p style="margin: 8px 0; font-size: 0.9rem; color: #666;">
            üìß <a href="mailto:mision3d.cl@gmail.com" style="color: #666; text-decoration: none; transition: color 0.2s;">mision3d.cl@gmail.com</a>
          </p>
          <p style="margin: 8px 0; font-size: 0.9rem; color: #666;">
            üìç La Florida<br>
            <span style="margin-left: 20px;">Santiago, Chile</span>
          </p>
          <p style="margin: 8px 0; font-size: 0.9rem; color: #666;">
            üïê Lunes a viernes, 9:00 - 18:00 hrs
          </p>
        </div>
        
        <div>
          <h4 style="margin: 0 0 15px 0; color: #0052cc; font-size: 1rem;">Informaci√≥n Legal</h4>
          <p style="margin: 8px 0; font-size: 0.9rem; color: #666;">
            Mision3D SpA
          </p>
          <p style="margin: 20px 0 0 0;">
            <a href="privacidad.html" style="color: #0052cc; text-decoration: none; margin-right: 15px; transition: color 0.2s;">Privacidad</a>
            <a href="terminos.html" style="color: #0052cc; text-decoration: none; transition: color 0.2s;">T√©rminos</a>
          </p>
        </div>
      </div>
      
      <div style="text-align: center; padding: 20px 0; border-top: 1px solid #333; margin-top: 20px;">
        <p style="margin: 0; font-size: 0.85rem; color: #888;">&copy; 2025 Misi√≥n 3D - Todos los derechos reservados</p>
      </div>
    </div>
  </footer>

  <!-- Carrito -->
  <!-- Carrito y modal (mismo markup que en index) -->
<aside id="cartDrawer" class="cart">
  <div class="cart-header"><h3>Tu carrito</h3><button id="closeCart">‚úï</button></div>
  <div id="cartAddedMsg" class="cart-added-msg"></div>
  <div id="cartItems" class="cart-items"></div>
  <div class="cart-footer">
    <div class="totals"><span>Total:</span><strong id="cartTotal">$0</strong></div>
    <button id="checkout" class="btn primary">Finalizar compra</button>
    <button id="clearCart" class="btn outline">Vaciar</button>
  </div>
</aside>
<div id="overlay" class="overlay"></div>
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <h3>Entrega</h3>
    <form id="checkoutForm" class="checkout-form">
      <div class="form-row">
        <label>M√©todo de env√≠o:<br>
          <select id="inputEnvio">
            <option value="retiro">Retiro en taller (sin costo)</option>
            <option value="domicilio">Env√≠o a domicilio (Santiago, $2.990)</option>
          </select>
        </label>
        <label>Nombre:<br><input id="inputName" autocomplete="name"></label>
        <label>Apellidos:<br><input id="inputApellido" autocomplete="family-name"></label>
      </div>
      <div class="form-row">
        <label>RUT (Obligatorio):<br><input id="inputRut" autocomplete="off"></label>
      </div>
      <div class="form-row">
        <label>Direcci√≥n:<br><input id="inputDireccion" autocomplete="street-address"></label>
      </div>
      <div class="form-row">
        <label>Agregar Nota (Personalizaci√≥n producto):<br><input id="inputNotes" autocomplete="off"></label>
      </div>
      <div class="form-row">
        <label>C√≥digo postal (opcional):<br><input id="inputPostal" autocomplete="postal-code"></label>
      </div>
      <div class="form-row">
        <label>Regi√≥n:<br>
          <select id="inputRegion">
            <option value="">Selecciona regi√≥n</option>
          </select>
        </label>
        <label>Comuna:<br>
          <select id="inputComuna">
            <option value="">Selecciona comuna</option>
          </select>
        </label>
      </div>
      <div class="form-row">
        <label>Tel√©fono:<br><input id="inputTelefono" autocomplete="tel"></label>
      </div>
      <div class="modal-actions">
        <button type="button" id="confirmCheckout" class="btn primary">Confirmar</button>
        <button type="button" id="cancelCheckout" class="btn outline">Cancelar</button>
      </div>
    </form>
  </div>
</div>
  <!-- (Se ha migrado el login a login.html) -->

  <!-- Toast de notificaci√≥n -->
  <div id="toast" class="toast">¬°Producto agregado al carrito!</div>
  <script src="script.js"></script>
  <script>
    // FAQ toggle
    document.addEventListener('DOMContentLoaded',()=>{
      const faqList=document.getElementById('faqList');
      if(!faqList) return;
      faqList.querySelectorAll('.faq-item').forEach(item=>{
        const q=item.querySelector('.faq-q');
        q.addEventListener('click',()=>{
          const open=item.classList.toggle('open');
          if(open){
            // cerrar otros
            faqList.querySelectorAll('.faq-item').forEach(o=>{if(o!==item) o.classList.remove('open')});
          }
        });
      });
    });

    // Procesar logo footer para hacer fondo blanco transparente (runtime, sin editar archivo original)
    document.addEventListener('DOMContentLoaded',()=>{
      const logo = document.querySelector('.footer-logo');
      if(!logo) return;
      function makeTransparent(){
        try {
          const w = logo.naturalWidth; const h = logo.naturalHeight;
          if(!w || !h) return; // imagen no lista
          const canvas = document.createElement('canvas');
          canvas.width = w; canvas.height = h;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(logo,0,0);
          const imgData = ctx.getImageData(0,0,w,h);
            const d = imgData.data;
            for(let i=0;i<d.length;i+=4){
              const r=d[i],g=d[i+1],b=d[i+2];
              // p√≠xeles muy claros -> transparente
              if(r>240 && g>240 && b>240){ d[i+3]=0; }
            }
          ctx.putImageData(imgData,0,0);
          logo.src = canvas.toDataURL('image/png');
          logo.classList.remove('remove-white'); // ya no necesitamos filtro
        } catch(err){ /* silencioso */ }
      }
      if(logo.complete) makeTransparent(); else logo.onload = makeTransparent;
    });
  </script>

<!-- Firebase RTDB (m√≥dulos) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getDatabase, ref, get, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

  // ‚öôÔ∏è Configuraci√≥n: usa tu databaseURL
  const firebaseConfig = {
    databaseURL: "https://mision3d-72b4a-default-rtdb.firebaseio.com/"
  };

  // Inicializa
  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);

  // üëâ Cargar productos desde RTDB y renderizar cat√°logo
  async function cargarProductosDesdeRTDB() {
    try {
      const snap = await get(ref(db, "productos"));
      if (snap.exists()) {
        const data = snap.val();
        // Convierte {id:{...}} -> [{id,...}]
        window.PRODUCTS = Object.entries(data).map(([id, p]) => ({ id, ...p }));
        
        // IMPORTANTE: Actualizar localStorage para que coincida con Firebase
        localStorage.setItem('PRODUCTS', JSON.stringify(window.PRODUCTS));
        
        // Disparar evento de productos listos
        document.dispatchEvent(new Event('productsReady'));
        console.log('‚úÖ Productos cargados desde Firebase. Evento productsReady disparado.');
        
        // Renderizar productos en la p√°gina de inicio (m√°ximo 5)
        renderHomeProducts(window.PRODUCTS.slice(0, 5));
      } else {
        console.warn("No hay productos en RTDB. Uso fallback local si existe.");
        // Si no hay nada en RTDB, limpiar localStorage tambi√©n
        localStorage.removeItem('PRODUCTS');
        // Si no hay nada en RTDB, usar productos del fallback en script.js
        if (window.PRODUCTS && window.PRODUCTS.length > 0) {
          document.dispatchEvent(new Event('productsReady'));
          console.log('‚úÖ Usando productos fallback. Evento productsReady disparado.');
          renderHomeProducts(window.PRODUCTS.slice(0, 5));
        }
      }
      // Tu funci√≥n de pintado ya existe en script.js (para catalogo.html)
      if (typeof window.renderCatalog === "function") renderCatalog("");
    } catch (err) {
      console.error("Error cargando productos:", err);
      // Si falla la conexi√≥n, usar productos locales si existen
      if (window.PRODUCTS && window.PRODUCTS.length > 0) {
        document.dispatchEvent(new Event('productsReady'));
        console.log('‚úÖ Error en Firebase, usando productos fallback. Evento productsReady disparado.');
        renderHomeProducts(window.PRODUCTS.slice(0, 5));
      }
      if (typeof window.renderCatalog === "function") renderCatalog("");
    }
  }
    // Funci√≥n para renderizar productos en la p√°gina de inicio
  function renderHomeProducts(products) {
    const grid = document.getElementById('homeProductsGrid');
    if (!grid) return;
    
    if (!products || products.length === 0) {
      grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#888">No hay productos disponibles</p>';
      return;
    }
    
    grid.innerHTML = products.map(p => {
      const desc = p.name.includes('Calendario') ? 'Calendario 3D con circuitos' :
                   p.name.includes('Beyblade') ? 'Personalizable con tu nombre' :
                   p.name.includes('Mascota') ? 'Tu mascota en 3D' :
                   p.name.includes('Pokebola') ? 'Pokebola coleccionable' : 
                   'Personalizado con tu logo';
      
      const price = p.price ? `$${p.price.toLocaleString('es-CL')}` : 'Consultar';
      
      return `
        <div class="card">
          <a href="producto.html?id=${p.id}" class="prod-link">
            <img src="${p.img || 'img/placeholder.png'}" alt="${p.name}">
          </a>
          <h4>
            <a href="producto.html?id=${p.id}" class="prod-link">${p.name}</a>
          </h4>
          <p>${desc}</p>
          <strong class="price">${price}</strong>
          <button class="add" data-id="${p.id}">Agregar</button>
        </div>
      `;
    }).join('');
    
    // Conectar eventos de los botones "Agregar"
    grid.querySelectorAll('.add').forEach(btn => {
      btn.addEventListener('click', () => {
        if (typeof window.add === 'function') {
          window.add(btn.dataset.id);
        }
      });
    });
  }

  // Llama al cargar inicio
  cargarProductosDesdeRTDB();

  // üëâ Guardar pedido en RTDB desde checkout.html (si esa p√°gina est√° abierta)
  // Nos ‚Äúenganchamos‚Äù al bot√≥n Confirmar si existe en el DOM.
  document.addEventListener("DOMContentLoaded", () => {
    const btnConfirm = document.getElementById("btnConfirmOrder");
    if (!btnConfirm) return; // esta l√≠nea corre en index y en otras p√°ginas tambi√©n

    btnConfirm.addEventListener("click", async () => {
      // Lee campos del checkout (todos existen en tu checkout.html):contentReference[oaicite:3]{index=3}
      const pedido = {
        email:       document.getElementById("inputEmail")?.value?.trim() || "",
        nombre:      document.getElementById("inputName")?.value?.trim() || "",
        apellidos:   document.getElementById("inputApellido")?.value?.trim() || "",
        rut:         document.getElementById("inputRut")?.value?.trim() || "",
        direccion:   document.getElementById("inputDireccion")?.value?.trim() || "",
        region:      document.getElementById("inputRegion")?.value || "",
        comuna:      document.getElementById("inputComuna")?.value || "",
        telefono:    document.getElementById("inputTelefono")?.value?.trim() || "",
        postal:      document.getElementById("inputPostal")?.value?.trim() || "",
        notas:       document.getElementById("inputNotes")?.value?.trim() || "",
        // m√©todo de env√≠o visible en la UI (por pagar / santiago)
        envio:       (document.querySelector('input[name="shipMethod"]:checked')?.value) || (document.getElementById("inputEnvio")?.value) || "",
        // m√©todo de pago (si agregas radios como en tu UI de pago):contentReference[oaicite:4]{index=4}
        pago:        (document.querySelector('input[name="payMethod"]:checked')?.value) || "",
        // Carrito (intenta leer de localStorage, con fallback)
        items:       (() => { try { return JSON.parse(localStorage.getItem("cart") || "[]"); } catch { return []; } })(),
        totalCLP:    (() => {
                        // si ya calculas total en el sidebar, podr√≠as leerlo del DOM; aqu√≠ hacemos sumatoria
                        const items = JSON.parse(localStorage.getItem("cart") || "[]");
                        return items.reduce((s, it) => s + (it.price * (it.qty || 1)), 0);
                      })(),
        estado:      "pendiente",
        createdAt:   serverTimestamp()
      };

      try {
        const refNuevo = await push(ref(db, "pedidos"), pedido);
        alert("‚úÖ Pedido registrado. ID: " + refNuevo.key + "\nTe contactaremos por correo/WhatsApp.");
        // Limpia carrito si quieres:
        localStorage.removeItem("cart");
        window.location.href = "index.html";
      } catch (e) {
        console.error(e);
        alert("‚ùå Hubo un problema registrando el pedido. Intenta nuevamente.");
      }
    });
  });
</script>

<script src="ux-enhancements.js"></script>
<script src="mobile-menu.js"></script>
<script type="module" src="firebase-rtdb.js"></script>
<!-- Scripts p√°gina producto -->
</body></html>