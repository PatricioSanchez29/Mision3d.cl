<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crear cuenta - Misi√≥n 3D</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="header-new-style.css" />
  <script src="consent.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    .register-container {
      max-width: 600px;
      margin: 40px auto;
      background: #f5f6f7;
      border-radius: 18px;
      padding: 40px 32px;
      box-shadow: 0 2px 16px #0001;
    }
    .register-title {
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 32px;
    }
    .form-group { margin-bottom: 18px; }
    .form-input { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #d1d5db; font-size: 15px; }
    .form-input.valid {
      border-color: #22c55e;
      background: #f0fdf4;
    }
    .form-input.invalid {
      border-color: #dc2626;
      background: #fef2f2;
    }
    .form-group { display: flex; flex-direction: column; position: relative; }
    .password-requirements-box li {
      margin-bottom: 2px;
      list-style: disc inside;
      color: #222;
    }
    .password-requirements-box li.valid {
      color: #22c55e;
      font-weight: 600;
    }
    .btn-register { width: 100%; padding: 14px; background: #1d4ed8; color: #fff; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
    .btn-register:hover { background: #2563eb; }
    .form-footer-text { text-align: center; margin-top: 18px; font-size: 14px; }
    .checkbox-group { margin-bottom: 12px; }
    .checkbox-group label { font-size: 14px; }
    .error-msg { color: #dc2626; margin-bottom: 10px; }
    .success-msg { color: #059669; margin-bottom: 10px; }
    .password-requirements-box {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px 18px;
      margin-top: 8px;
      font-size: 14px;
      color: #222;
      box-shadow: 0 2px 8px #0001;
    }
    .password-requirements-box ul {
      margin: 8px 0 0 0;
      padding-left: 18px;
    }
    .password-requirements-box li {
      margin-bottom: 2px;
    }
  </style>
</head>
<body class="login-page">
  <header class="header">
    <!-- Bot√≥n Hamburguesa (solo m√≥vil) -->
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Abrir men√∫">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>

    <h1 class="logo" style="margin:0;display:flex;align-items:center">
      <a href="index.html" style="display:inline-flex;align-items:center;text-decoration:none">
        <img src="img/Logo_Mision3d.jpg" alt="Misi√≥n 3D" class="logo-img" onerror="this.onerror=null;this.replaceWith(Object.assign(document.createElement('span'),{className:'logo-text',textContent:'Misi√≥n 3D'}));" />
      </a>
    </h1>
    <nav class="nav">
      <a href="index.html">Inicio</a>
      <a href="catalogo.html" id="navCatalog">Cat√°logo</a>
      <a href="#contacto">Contacto</a>
    </nav>
    <div class="search-header">
      <div class="advanced-search-bar">
        <select id="headerCategorySelect" class="category-select">
          <option value="all">Todas las categor√≠as</option>
        </select>
        <input type="text" id="searchInput" placeholder="¬øQu√© est√°s buscando?" class="search-input" autocomplete="off">
        <button type="button" id="headerSearchBtn" class="search-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
      <div id="searchSuggestions" class="search-suggestions"></div>
      <div id="headerTrendChips" class="trend-chips" aria-label="B√∫squedas populares"></div>
    </div>
    <div class="right-actions" style="display:flex;align-items:center;gap:10px">
      <div id="userArea" class="user-area">
        <div class="dropdown" style="position:relative;">
          <button class="btn small outline" id="loginDropdownBtn" style="display:flex;align-items:center;gap:6px;">
            <svg width="22" height="22" fill="#5b3fa2" viewBox="0 0 24 24"><path d="M12 12c2.7 0 8 1.34 8 4v2H4v-2c0-2.66 5.3-4 8-4zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/></svg>
            <span style="font-weight:600;letter-spacing:1px;">ACCESO</span>
          </button>
          <div class="dropdown-content" id="loginDropdownContent" style="display:none;position:absolute;right:0;z-index:10;background:#fff;border-radius:8px;box-shadow:0 2px 8px #0002;padding:8px 0;min-width:140px;">
            <a href="login.html" style="display:block;padding:8px 18px;color:#222;text-decoration:none;">Ingresar</a>
            <a href="register.html" style="display:block;padding:8px 18px;color:#222;text-decoration:none;">Crear cuenta</a>
          </div>
        </div>
      </div>
      <button class="cart-btn" id="openCart" aria-label="Abrir carrito">üõí <span id="cartCount">0</span></button>
    </div>
  </header>
  <div class="register-container">
    <div style="margin-bottom: 18px; color: #7a7a7a; font-size: 15px;">
      <a href="index.html" style="color: #009fe3; text-decoration: none; font-weight: 500;">Inicio</a> &gt; Registro de Cliente
    </div>
    <div class="register-title">CREAR UNA CUENTA</div>
    <form id="registerForm">
      <div class="form-group">
        <label for="regEmail">E-mail *</label>
        <input type="email" id="regEmail" class="form-input" required autocomplete="email">
      </div>
      <div class="form-group">
        <label for="regPhone">Tel√©fono *</label>
        <input type="tel" id="regPhone" class="form-input" required autocomplete="tel">
      </div>
      <div class="form-group">
        <label for="regPassword">Contrase√±a *</label>
        <div style="position:relative;display:flex;align-items:center;">
          <input type="password" id="regPassword" class="form-input" required autocomplete="new-password" style="flex:1;">
          <button type="button" id="togglePass1" style="position:absolute;right:10px;background:none;border:none;cursor:pointer;font-size:14px;padding:6px;color:#1f2937;" tabindex="-1" aria-label="Mostrar/Ocultar contrase√±a">Mostrar</button>
        </div>
        <div class="password-requirements-box" id="passwordReqBox">
          <strong>Requisitos de contrase√±a:</strong>
          <ul>
            <li id="req-length">M√≠nimo 8 caracteres</li>
            <li id="req-mayus">Al menos una may√∫scula</li>
            <li id="req-minus">Al menos una min√∫scula</li>
            <li id="req-num">Al menos un n√∫mero</li>
            <li id="req-symbol">Al menos un s√≠mbolo</li>
          </ul>
        </div>
      </div>
      <div class="form-group">
        <label for="regPassword2">Confirmar Contrase√±a *</label>
        <div style="position:relative;display:flex;align-items:center;">
          <input type="password" id="regPassword2" class="form-input" required autocomplete="new-password" style="flex:1;">
          <button type="button" id="togglePass2" style="position:absolute;right:10px;background:none;border:none;cursor:pointer;font-size:14px;padding:6px;color:#1f2937;" tabindex="-1" aria-label="Mostrar/Ocultar contrase√±a">Mostrar</button>
        </div>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="newsletter">
        <label for="newsletter">Subscr√≠bete para recibir noticias y ofertas exclusivas</label>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="termsCheckbox" required>
        <label for="termsCheckbox">He le√≠do y acepto los <a href="#" onclick="alert('Demo: T√©rminos y Condiciones'); return false;">T√©rminos y Condiciones</a>.</label>
      </div>
      <div id="registerMsg"></div>
      <button type="submit" class="btn-register">CONFIRMAR</button>
      <div class="form-footer-text">
        ¬øYa tienes una cuenta? <a href="login.html">Puedes ingresar aqu√≠</a>.
      </div>
    </form>
  </div>
  <script>
    const SUPABASE_URL = 'https://ytuwkynphdttotifgyaf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0dXdreW5waGR0dG90aWZneWFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE3ODUyMzYsImV4cCI6MjA3NzM2MTIzNn0.JIFDBzpYTcChc1fnmp6pFL0K9SZPnn2ltp4iKxLdSus';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // Validaci√≥n en tiempo real de email
    const regEmail = document.getElementById('regEmail');
    const emailCheck = document.getElementById('emailCheck');
    regEmail.addEventListener('input', function() {
      const emailRegex = /^[\w-.]+@([\w-]+\.)+[\w-]{2,}$/;
      if (regEmail.value.trim() === '') {
        regEmail.classList.remove('valid', 'invalid');
      } else if (emailRegex.test(regEmail.value.trim())) {
        regEmail.classList.add('valid');
        regEmail.classList.remove('invalid');
      } else {
        regEmail.classList.remove('valid');
        regEmail.classList.add('invalid');
      }
    });

    // Validaci√≥n en tiempo real de tel√©fono chileno
    const regPhone = document.getElementById('regPhone');
    const phoneCheck = document.getElementById('phoneCheck');
    regPhone.addEventListener('input', function() {
      const phoneRegex = /^9\d{8}$/;
      if (regPhone.value.trim() === '') {
        regPhone.classList.remove('valid', 'invalid');
      } else if (phoneRegex.test(regPhone.value.trim())) {
        regPhone.classList.add('valid');
        regPhone.classList.remove('invalid');
      } else {
        regPhone.classList.remove('valid');
        regPhone.classList.add('invalid');
      }
    });

    // Validaci√≥n en tiempo real de requisitos de contrase√±a
    const regPassword = document.getElementById('regPassword');
    const reqLength = document.getElementById('req-length');
    const reqMayus = document.getElementById('req-mayus');
    const reqMinus = document.getElementById('req-minus');
    const reqNum = document.getElementById('req-num');
    const reqSymbol = document.getElementById('req-symbol');
    regPassword.addEventListener('input', function() {
      const val = regPassword.value;
      // Largo
      if (val.length >= 8) reqLength.classList.add('valid'); else reqLength.classList.remove('valid');
      // May√∫scula
      if (/[A-Z]/.test(val)) reqMayus.classList.add('valid'); else reqMayus.classList.remove('valid');
      // Min√∫scula
      if (/[a-z]/.test(val)) reqMinus.classList.add('valid'); else reqMinus.classList.remove('valid');
      // N√∫mero
      if (/\d/.test(val)) reqNum.classList.add('valid'); else reqNum.classList.remove('valid');
      // S√≠mbolo
      if (/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(val)) reqSymbol.classList.add('valid'); else reqSymbol.classList.remove('valid');
    });

    // Mostrar/ocultar contrase√±a
    document.getElementById('togglePass1').addEventListener('click', function() {
      const pass = document.getElementById('regPassword');
      pass.type = pass.type === 'password' ? 'text' : 'password';
      this.textContent = pass.type === 'password' ? 'Mostrar' : 'Ocultar';
    });
    document.getElementById('togglePass2').addEventListener('click', function() {
      const pass = document.getElementById('regPassword2');
      pass.type = pass.type === 'password' ? 'text' : 'password';
      this.textContent = pass.type === 'password' ? 'Mostrar' : 'Ocultar';
    });

    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = regEmail.value.trim();
      const phone = regPhone.value.trim();
      const password = regPassword.value;
      const password2 = document.getElementById('regPassword2').value;
      const terms = document.getElementById('termsCheckbox').checked;
      const msg = document.getElementById('registerMsg');
      msg.textContent = '';
      msg.className = '';
      // Validaci√≥n de email
      const emailRegex = /^[\w-.]+@([\w-]+\.)+[\w-]{2,}$/;
      if (!email || !emailRegex.test(email)) {
        msg.textContent = 'Ingresa un correo electr√≥nico v√°lido.';
        msg.className = 'error-msg';
        regEmail.classList.add('invalid');
        return;
      }
      // Validaci√≥n de tel√©fono chileno (9 d√≠gitos, comienza con 9)
      const phoneRegex = /^9\d{8}$/;
      if (!phone || !phoneRegex.test(phone)) {
        msg.textContent = 'Ingresa un tel√©fono chileno v√°lido (ej: 912345678).';
        msg.className = 'error-msg';
        regPhone.classList.add('invalid');
        return;
      }
      // Validaci√≥n de contrase√±a segura
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).{8,}$/;
      if (!passwordRegex.test(password)) {
        msg.textContent = 'La contrase√±a debe tener m√≠nimo 8 caracteres, incluir may√∫scula, min√∫scula, n√∫mero y s√≠mbolo.';
        msg.className = 'error-msg';
        return;
      }
      if (password !== password2) {
        msg.textContent = 'Las contrase√±as no coinciden.';
        msg.className = 'error-msg';
        return;
      }
      if (!terms) {
        msg.textContent = 'Debes aceptar los T√©rminos y Condiciones.';
        msg.className = 'error-msg';
        return;
      }
      // Registro con Supabase
      // Registro cl√°sico con confirmaci√≥n de correo
      const { error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: window.location.origin + '/login.html',
          data: { phone }
        }
      });
      if (error) {
        msg.textContent = error.message;
        msg.className = 'error-msg';
      } else {
        msg.textContent = '¬°Registro exitoso! Revisa tu correo para confirmar tu cuenta.';
        msg.className = 'success-msg';
        document.getElementById('registerForm').reset();
        regEmail.classList.remove('valid');
        regPhone.classList.remove('valid');
        reqLength.classList.remove('valid');
        reqMayus.classList.remove('valid');
        reqMinus.classList.remove('valid');
        reqNum.classList.remove('valid');
        reqSymbol.classList.remove('valid');
      }
    });
  </script>
  <footer class="footer" style="background:#181f2a;color:#bfc7d5;padding:40px 0 20px 0;margin-top:40px;width:100vw;">
    <div style="max-width:1200px;margin:0 auto;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-start;gap:32px;">
      <div style="flex:1;min-width:220px;display:flex;flex-direction:column;align-items:center;">
        <img src="img/Logo_Mision3d.jpg" alt="Mision3D Logo" style="width:110px;margin-bottom:12px;">
        <div style="font-size:1.1rem;font-weight:500;">Impresi√≥n 3D personalizada</div>
        <div style="font-size:0.98rem;color:#bfc7d5;">Transforma tus ideas en realidad</div>
      </div>
      <div style="flex:1;min-width:220px;text-align:center;">
        <div style="color:#00bfff;font-weight:bold;font-size:1.1rem;margin-bottom:8px;">Contacto</div>
        <div><span style="margin-right:6px;">üìß</span>mision3d.cl@gmail.com</div>
        <div><span style="margin-right:6px;">üìç</span>La Florida<br>Santiago, Chile</div>
        <div><span style="margin-right:6px;">‚è∞</span>Lunes a viernes, 9:00 - 18:00 hrs</div>
      </div>
      <div style="flex:1;min-width:220px;text-align:center;">
        <div style="color:#00bfff;font-weight:bold;font-size:1.1rem;margin-bottom:8px;">Informaci√≥n Legal</div>
        <div>Mision3D SpA</div>
        <div style="margin-top:8px;"><a href="privacidad.html" style="color:#00bfff;text-decoration:none;margin-right:12px;">Privacidad</a><a href="terminos.html" style="color:#00bfff;text-decoration:none;">T√©rminos</a></div>
      </div>
    </div>
    <hr style="border:none;border-top:1px solid #2a3140;margin:32px 0 16px 0;">
    <div style="text-align:center;color:#bfc7d5;font-size:0.95rem;">¬© 2025 Misi√≥n 3D - Todos los derechos reservados</div>
  </footer>
</body>
</html>
